<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Map Game</title>
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="http://maps.googleapis.com/maps/api/js"></script>
<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<h1 id="main-head">How well do you know the World?</h1>
<div id="pic-div">
<img id="world-pic" src="https://openclipart.org/image/2400px/svg_to_png/218125/3d-Earth-Globe.png"/>
</div>
<p id="instructions">This paragraph will explain how to play and also give tips on making it work the best</p>
<div id="button-div">
<button id="start-button" type="button">Click to Start</button>
</div>
<div id="country-box"><h1 id="country-name"></h1></div>
<div id="overlay-div"></div>
<div id="container">
        <div id="popup"></div>
</div>
<div id="map-div">
<div id="prompt-div"></div>
<img id="world-map" src="http://www.legallandconverter.com/images/worldthumb.jpg"/>
</div>
<script>
var countryList = ["United States of America","Australia","Canada","United States of America", "Australia", "Canada", "United States of America", "Australia", "Canada"];
var wrongCounter = 0;
var roundCounter = 0; 
var chancesLeft = 3; 
$("#prompt-div").hide();
function mainGame() {
	alert("You have started the game"); 
	$("#country-name").text(countryList[roundCounter]);
	$("#world-map").on("click", function(event) {
        	console.log("we hear you");
        	console.log(event.pageY + "px");
        	console.log(event.pageX + "px");
        	console.log(convertToLat(event.pageX));
       		console.log(convertToLong(event.pageY));
        	var offset = $(this).offset();
        	var lat = convertToLat(event.pageX - offset.left);
        	var longitude = convertToLong(event.pageY - offset.top);
        	getLocation(lat,longitude, roundCounter);
		roundCounter++;
		//$("#country-name").text(countryList[roundCounter]);
		$("#popup").off("click");
	})
}
$("#start-button").on("click", function() {
	console.log("You clicked the start button");
	//$("#prompt-div").show();
	$("#country-box").append("<h1 id=\"country-name\"></h1>");
	roundCounter = 0;
	mainGame();
})
function lose()
{
	alert("Better luck next time");
	$("#country-box").empty();
}
function win()
{
	alert("Wow, you're like really smart");
	$("#country-box").empty();
}
function convertToLat(x)
{
	if (x <= 24)
	{
		return -1;
	}
	else if (x > 1044)
	{
		return -1;
	}
	else if ((x > 24) && (x < 533))
	{
		var factor = 180/533;
		var toReturn = (180 - (factor * x));
		return -toReturn;
	}
	else 
	{
		var factor = 180/533;
		var toReturn = factor * x;
		return (toReturn - 180);
	}
}
function convertToLong(y)
{ 
	if (y < 30)
	{
		return -1;
	}
	else if (y > 466)
	{
		return -1;
	}
	else if ((y > 30) && (y < 300))
	{
		var factor = 90/300; 
		var toReturn = 90 - (factor * y);
		return toReturn;
	} 
	else 
	{
		var factor = 60/167;
		var toReturn = factor * (y - 300);
		return -toReturn;
	}
}
function getLocation(x,y, counter)
{
	var myUrl = "http://api.opencagedata.com/geocode/v1/json?q=" + y +",+" + x + "&key=7e94b745a749cb44413754445f608f4a";
	$.ajax({
		url: myUrl, 
		dataType: "json",
		success: function(parsed_json) {
			console.log(parsed_json.results[0].components.country);
			//alert(parsed_json.results[0].components.country);
			//answer = parsed_json.results[0].components.country;
			var selection = parsed_json.results[0].components.country;
			console.log(counter + ", the correct response was " + countryList[counter]); 
			if (selection == countryList[counter])
			{
				$("#popup").empty(); 
				console.log("you were right");
				$("#popup").append("<h1 id=\"correct\">CORRECT</h1><br><p id=\"status\">Current Round: " + roundCounter + " Chances Left: " + chancesLeft + "</p>");
				$("#overlay-div").slideToggle();
				$("#container").slideToggle();
				$("#popup").css("background","green")
					.slideToggle()
					.click(function() {
						console.log("We are stuck in here");
						$("#popup").slideToggle();
						$("#container").slideToggle();
						$("#overlay-div").slideToggle();
					});
				//$("#country-name").text(countryList[roundCounter]);
				if (roundCounter == countryList.length)
				{
					win();
				}
			}
			else 
			{
				wrongCounter++;
				chancesLeft--;
				$("#popup").empty();
				$("#popup").append("<h1 id=\"correct\">INCORRECT</h1><br><p id=\"status\">Current Round: " + roundCounter + " Chances Left: " + chancesLeft + "</p>");
				$("#overlay-div").show();
                                $("#container").show();
                                $("#popup").css("background","red")
                                        .show()
                                        .click(function() {
                                                $("#popup").slideToggle();
                                                $("#container").slideToggle();
                                                $("#overlay-div").slideToggle();
                                        });
				//$("#country-name").text(countryList[roundCounter]);
				//wrongCounter++;
				if (wrongCounter == 3)
				{
					lose();
				}
			}
			return parsed_json.results[0].components.country;
		},
		fail: function(error) {
			console.log(error);
		}
	});
} 
</script>
</body>
</html>
