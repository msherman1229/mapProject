<!DOCTYPE html>
<html>
<head>
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="http://maps.googleapis.com/maps/api/js"></script>
</head>
<body>
<img id="world-map" src="http://www.legallandconverter.com/images/worldthumb.jpg"/>

<script>
$("#world-map").on("click", function(event) {
	console.log("we hear you");
	console.log(event.pageY + "px");
	console.log(event.pageX + "px");
	console.log(convertToLat(event.pageX));
	console.log(convertToLong(event.pageY));
	var lat = convertToLat(event.pageX);
	var longitude = convertToLong(event.pageY);
	getLocation(lat,longitude);
})
function convertToLat(x)
{
	if (x <= 24)
	{
		return -1;
	}
	else if (x > 1044)
	{
		return -1;
	}
	else if ((x > 24) && (x < 533))
	{
		var factor = 180/533;
		var toReturn = (180 - (factor * x));
		return -toReturn;
	}
	else 
	{
		var factor = 180/533;
		var toReturn = factor * x;
		return (toReturn - 180);
	}
}
function convertToLong(y)
{
	if (y < 30)
	{
		return -1;
	}
	else if (y > 466)
	{
		return -1;
	}
	else if ((y > 30) && (y < 300))
	{
		var factor = 90/300; 
		var toReturn = 90 - (factor * y);
		return toReturn;
	} 
	else 
	{
		var factor = 60/167;
		var toReturn = factor * (y - 300);
		return -toReturn;
	}
}
/*function getLocation(x,y)
{
	geocoder = new google.maps.Geocoder;
	var location1 = {lat: parseFloat(y), lng: parseFloat(x)};
	geocoder.geocode({'location':location1}, function(results) {
		console.log(results[1].formatted_address);
		console.log(results[4].formatted_address);
	});
	//Probably want to add in some fail cases
}*/
/*function getLocation(x,y) 
{
	var myUrl = "https://montanaflynn-geocoder.p.mashape.com/reverse?latitude=" + y + "&longitude=" + x;
	$.ajax({
		url: myUrl,
		type: 'GET', 
		datatype: 'json',
		success: function(data) {
			alert(JSON.stringify(data));},
		error: function(err) {alert(err);},
		beforeSend: function(xhr) {
		xhr.setRequestHeader("X-Mashape-Authorization", "xsV9GnCpcxmshOYb9GvA4nfGH2wzp1pPuYzjsnqZqFofrEKy7Z");
		}
	});
}*/
function getLocation(x,y)
{
	var myUrl = "http://api.opencagedata.com/geocode/v1/json?q=" + y +",+" + x + "&key=7e94b745a749cb44413754445f608f4a";
	$.ajax({
		url: myUrl, 
		dataType: "json",
		success: function(parsed_json) {
			console.log(parsed_json.results[0].components.country);
		},
		fail: function(error) {
			console.log(error);
		}
	});
} 
</script>
</body>
</html>
